---
title: "Projet final"
author: "Léa Alarcon"
date: "20/10/2021"
output:
  html_document: default
  pdf_document: default
---



"L’abolition de l’esclavage proclamé à la Convention"

![](/Users/lea/R_projet/Projet_R_final/abolit.jpg)


"Monsiaux ou Monsiau, Nicolas-André , Dessinateur
Thévenin, Charles (dit Carle) , Dessinateur
Anonyme , Dessinateur" 
- Musée Carnavalet, Histoire de Paris


Commentaire historique: 

"Expo : L’abbé Grégoire, Archives Nationales, 1951. L’esclavage dans les colonies françaises et son abolition en 1848, musée de France d’Outremer, 1948. Goya et l’âge de la Révolution, Hambourg, 1980. La Révolution française / Le Premier Empire / dessins du musée Carnavalet, 1983. “Bernard Molitor”, Luxembourg, musée d’Histoire de la Ville, 1995.Bibl : Guide du visiteur, musée Carnavalet, 1932. Sagnac Ph. et Robiquet J. : La Révolution de 1789. Ph. Bordas, “L’art de la Révolution française, Revue de l’art, 1984.L’esclavage fut aboli par un décret de la Convention du 16 Pluviose, an II de la République." - Musée Carnavalet, Histoire de Paris


#### Netoyage des données

```{r}
library(pdftools) # reading in the PDF tables
library(tidyverse) # requires tidy 1.0 and dplyr 1.0 for below example

# black past, african names & slave routes database
# Just cleaned up the names

routes <- read_csv("https://raw.githubusercontent.com/rfordatascience/tidytuesday/master/data/2020/2020-06-16/slave_routes.csv")

# test plot
cleaning_routes %>% 
  mutate(decade = 10 * (year_arrival %/% 10)) %>% 
  group_by(decade) %>% 
  summarize(n = sum(n_slaves_arrived, na.rm = TRUE)) %>% 
  ggplot(aes(x = decade, y = n)) + 
  geom_col() +
  scale_y_continuous(labels = scales::label_number())


raw_names <- read_csv("https://raw.githubusercontent.com/rfordatascience/tidytuesday/master/data/2020/2020-06-16/african_names.csv")

raw_names %>% 
  ggplot(aes(x = age)) +
  geom_density() + facet_wrap(~gender, ncol = 1)

# Census Populations ------------------------------------------------------

# Read in the raw PDF
raw_pdf <- pdftools::pdf_text("https://mapmaker.rutgers.edu/REFERENCE/Hist_Pop_stats.pdf")

# test on one page
raw_text <- raw_pdf[[31]] %>% 
  str_split("\n")

# Some attempts at cleaning the data
mw_test <- raw_text %>%
  unlist() %>% 
  .[7:38] %>% 
  .[str_detect(., ".......")] %>% 
  .[str_which(str_sub(., 1), "1")] %>% 
  str_remove_all("\\.") %>% 
  .[c(1,3,5,9:26)] %>% 
  str_replace_all("([0-9])(\\s)([0-9])", "\\1\\3") %>% 
  str_squish() 


midwest <- mw_test %>% 
  read_table(col_names = FALSE) %>% 
  separate(X2, into = c("total", "white", "black", "native",
                        "asian", "other", "hispanic", "white_other"
  )) %>% 
  select(year = X1, total:black) %>% 
  filter(year <= 1870) %>% 
  mutate(across(c(total:black), parse_number)) %>% 
  add_column(black_free = c(273080, 69291, 48185, 30743, 15664, 6931, 3630, 500)) %>% 
  mutate(black_slaves = black - black_free, 
         region = "Midwest") %>% 
  select(region, everything())


# trying for the US Total
us_raw <- raw_pdf[[29]] %>% 
  str_split("\n") %>% 
  unlist()

str_subset(us_raw, all_years) %>% 
  str_subset("Table", negate = TRUE) %>% 
  .[c(1:9)]

all_years <- seq(1790, 1870, by = 10) %>% 
  paste0(collapse = "|")

us_raw[str_detect(us_raw, all_years)] %>% 
  .[2:10]

# Create a robust function to get tables
get_population <- function(page_number, division, free_blacks){
  
  # match regions and divisions
  regions <- case_when(
    division %in% c("New England","Middle Atlantic") ~ "Northeast",
    division %in% c("East North Central", "West North Central") ~ "Midwest",
    division %in% c("South Atlantic", "East South Central", "West South Central") ~ "South",
    division %in% c("Mountain", "Pacific") ~ "West",
    division %in% c("Northeast", "Midwest", "South", "West") ~ division,
    TRUE ~ "USA Total"
  )
  
  # years to filter down to
  all_years <- seq(1790, 1870, by = 10) %>% 
    paste0(collapse = "|")
  
  # get specific page and separate into lines
  raw_pdf_text <- raw_pdf[[page_number]] %>% 
    str_split("\n") %>% 
    unlist()
  
  # filter down to matching years and exclude table row
  raw_table <- str_subset(raw_pdf_text, all_years) %>% 
    str_subset("Table", negate = TRUE)
  
  clean_table <-  raw_table %>% 
    str_remove_all("\\.") %>% 
    # find space in between digits and drop the space
    str_replace_all("([0-9])(\\s)([0-9])", "\\1\\3") %>% 
    str_squish() %>% 
    # couldn't get this to work nicely, but this works fine w/ separate
    read_table(col_names = FALSE) %>% 
    separate(X2, into = c("total", "white", "black", "native",
                          "asian", "other", "hispanic", "white_other"
    )) %>% 
    select(year = X1, total:black) %>% 
    # parse character numbers
    mutate(across(c(total:black), parse_number)) %>% 
    # exclude percentage
    filter(total > 1000) %>% 
    # add in the free black people
    add_column(black_free = free_blacks) %>%
    # assign region/division
    mutate(black_slaves = black - black_free,
           division = division,
           region = regions,
           division = if_else(division == region, NA_character_, division)) %>%
    select(region, division, everything())
  
  # return table
  clean_table
  
}

# Testing for Midwest
get_population(31, "Midwest", c(273080, 69291, 48185, 30743, 15664, 6931, 3630, 500))

# Testing for US
get_population(29, "USA", c(273080, 69291, 48185, 30743, 15664, 6931, 3630, 500, 0))

# Apply the function at scale
total_census <- tibble(
  page_number = c(29:42),
  division = c("USA Total", "Northeast", "Midwest", "South", "West", 
             "New England", "Middle Atlantic", "East North Central",
             "West North Central", "South Atlantic", 
             "East South Central", "West South Central",
             "Mountain", "Pacific"
             ),
  # manually aggregated
  free_blacks = list(
    c(4880009, 488070, 434495,386293,619599,233634,186446,108435,59527),
    c(179738,155983,149526,141559,122434,92723,75156,46696,27070),
    c(273080, 69291, 48185, 30743, 15664, 6931, 3630, 500),
    c(4420811, 258346,235569,213991,181501,133980,107660,61239,32457),
    c(6380,4450,1215),
    c(31705, 24711,23021,22634,21331,20782,19488,17313,13117),
    c(148033,131272,126505,118925,101103,71941,55668,29383,13953),
    c(130497,63699,45195,28997,15095,6584,3025,500),
    c(142583,5592,2990,1746,569,347,605),
    c(2216705, 217753,197474,171778,153087,116920,96803,60009,31982),
    c(1464252, 21447,19628,16246,11563,6525,3270,1230,475),
    c(739854, 19146,18467,25967,16851,10535,7587),
    c(1555,206,46),
    c(4825,4244,1169)
  )
) %>% 
  mutate(data = pmap(., get_population)) %>% 
  select(data) %>% 
  unnest(data) %>% 
  mutate(region)

# test plot
total_census %>% 
  mutate(percent_slaves = black_slaves/black * 100) %>% 
  filter(is.na(division), region != "USA Total")%>% 
  ggplot(aes(x = year, y = percent_slaves, color = region)) +
  geom_line() +
  facet_wrap(~region)

total_census %>% 
  mutate(percent_slaves = black_slaves/black * 100) %>% 
  filter(is.na(division), region != "USA Total") %>% 
  group_by(region) %>% 
  filter(year != 1870) %>% 
  summarize(mean_slavery = mean(percent_slaves),
            sd = sd(percent_slaves)) %>% 
  arrange(desc(mean_slavery))

total_census %>% 
  mutate(percent_slaves = black_slaves/black * 100) %>% 
  filter(is.na(division), region != "USA Total") %>% 
  filter(year != 1870) %>% 
  arrange(desc(percent_slaves)) %>% 
  ggplot(aes(x = fct_inorder(region), y = percent_slaves, color = year)) +
  viridis::scale_color_viridis() +
  geom_jitter(size = 3, width = 0.1) +
  geom_boxplot(width = 0.75, alpha = 0.5) +
  labs(x = "", y = "Blacks enslaved as a percentage of the region's total black population  (%)",
       
       subtitle = "Years between 1790 and 1860") +
  scale_y_continuous(breaks = c(0, 25, 50, 75, 90, 100)) +
  geom_hline(yintercept = 90)

total_census %>% write_csv("https://raw.githubusercontent.com/rfordatascience/tidytuesday/master/data/2020/2020-06-16/census.csv")


```

```{r include=FALSE}
# Get the Data

blackpast <- readr::read_csv('https://raw.githubusercontent.com/rfordatascience/tidytuesday/master/data/2020/2020-06-16/blackpast.csv')
census <- readr::read_csv('https://raw.githubusercontent.com/rfordatascience/tidytuesday/master/data/2020/2020-06-16/census.csv')
slave_routes <- readr::read_csv('https://raw.githubusercontent.com/rfordatascience/tidytuesday/master/data/2020/2020-06-16/slave_routes.csv')
african_names <- readr::read_csv('https://raw.githubusercontent.com/rfordatascience/tidytuesday/master/data/2020/2020-06-16/african_names.csv')

# Or read in with tidytuesdayR package (https://github.com/thebioengineer/tidytuesdayR)

# Either ISO-8601 date or year/week works

# Install via devtools::install_github("thebioengineer/tidytuesdayR")

#tuesdata <- tidytuesdayR::tt_load('2020-06-16')
#tuesdata <- tidytuesdayR::tt_load(2020, week = 25)


#blackpast <- tuesdata$blackpast
```


### 1. Contexte 

Les données utilisées proviennent des Archives du recensement« Slave Voyages et de Black Past » aux Etats-Unis. 
Le but est de montrer l’étendue de l’esclavagisme, et de montrer la violence et la répression envers ces personnes. 
Nous avons de plus un devoir de mémoire, il semble donc cohérent, de pouvoir travailler et partager ces données. 

Explications des tableaux : 

- africain_names : « african_names.csv enregistre l’historique des esclaves libérés. Ces esclaves étaient pour la plupart libérés pendant le transport par bateau, leurs noms et leurs âges étaient consignés et retournés dans des ports libres. Veuillez noter, bien que les données soient exactes comme les dossiers historiques peuvent l’être, souvent les sauveteurs et les Africains ne parlaient pas la même langue, de sorte que les noms et les âges sont approximatifs. Il s'agit essentiellement d'un enregistrement des esclaves qui ont été libérés lors de leur transport forcé.» (github)
- slave_routes.csv : les routes des esclaves 
- blackpast.csv : données sur le passé (évènements, dates..)
- census.cvs : informations sur le nombre de personnes par régions


### 2. Analyse

```{r include=FALSE}
## attention, ici il faut installer des packages pour pouvoir utiliser les libraries
library(tidyverse) 
library(stringr) ## question 3 pour compter les variables
library(ggthemes) ##theme des plots
library(cowplot) ##theme des plots
library("vistime") #pour le diagramme
```


### 2.1 Analyse de la population étudiée (tableau african_names)


#### Question 1 : Quel est l'âge moyen des personnes étudiées, l'âge maximum et minimum ? 

```{r}
african_names %>% 
summarise(mean_age= mean(age, na.rm = TRUE), sd_age = sd(age, na.rm =T),max_age=max(age,na.rm=T), min_age=min(age, na.rm=T))
```

L'âge moyen de la population (esclave) est de 19 ans, avec un écart type de d'environ 9 années. 

L'âge le plus jeune est de 0.5 ans (6 mois) et l'âge le plus élevé est 77 ans. 
*Je pense que l'âge des bébés (0.5 ans) est approximé*



#### Question 2 : Quelle est la taille moyenne de notre population ? 

```{r}
african_names[african_names==0] <- NA ## permet de tranformer les 0 en NA, dans le code en dessous je ne prends pas les NA. 

african_names %>% 
  summarise(mean_taille= mean(height, na.rm = TRUE)*2.54, sd_taille = sd(height, na.rm =T)*2.54,max_taille=max(height,na.rm=T)*2.54, min_taille=min(height, na.rm=T)*2.54)
```
Aux USA, la taille est généralement calculée en pouce, nous allons donc multiplier celle du tableau par 2.54 pour l'avoir en cm. 
De plus, j'ai du tranformer les 0 en NA, sinon cela fausse ma taille minimum. 

En moyenne, la population (esclave) étudiée mesure 1m49, l'écart type est de 17 cm. 
La taille minimum est de 30 cm (probablement à cause des conditions de vie difficiles de la mère) et la taille maximum est de 2m16. 


#### Question 3 : Quelle est le nombre de femmes, d'hommes, d'enfants dans notre population ? 
```{r}

#an.data<-data.frame(number=1:4, string=c("Woman", "Man", "Girl", "Boy"), stringsAsFactors = F)

## On va compter le nombre d'Homme, Femme et enfants avec la package string, sans prendre les valeurs manquantes en compte. 

an.dataM <- str_count(african_names$gender, "Man")
a1 <- sum(an.dataM, na.rm=T)

an.dataW <- str_count(african_names$gender, "Woman")
b1 <- sum(an.dataW, na.rm=T)

an.dataG <- str_count(african_names$gender, "Girl")
c1 <- sum(an.dataG, na.rm=T)

an.dataB <- str_count(african_names$gender, "Boy")
d1 <- sum(an.dataB, na.rm=T)

## Nombre d'adultes :
e1 <-sum(an.dataM+an.dataW, na.rm=T)

## Nombre d'enfants : 
f1<- sum(an.dataG+an.dataB, na.rm=T)

## Le nombre de données NA : 
g1 <- 91490 - sum(an.dataB+an.dataG+an.dataW+an.dataM, na.rm=T) ##ici je prends toutes les observations et j'enleve des données que je connais et que j'ai calculée avant. n=91490 dans le tableau african_names


## création de deux tableaux à la main : 

type <- c("Nombre de personnes")
Hommes <- c(a1)
Femmes <- c(b1)
Filles <- c(c1)
Garçons <- c(d1)

type2 <-c("Nombre de personnes total par groupe")
Total_adultes <- c(e1)
Total_enfants <- c(f1)
Total_donnees_manquantes <-c(g1)

an.table<-cbind(Hommes, Femmes, Filles, Garçons)
rownames(an.table)<-type

an.table2 <- cbind(Total_adultes, Total_enfants, Total_donnees_manquantes)
rownames(an.table2)<-type2

t_an.table<-t(an.table) ## J'inverse le sens, car c'est plus lisible
t_an.table 

t_an.table2<-t(an.table2) ## J'inverse le sens, car c'est plus lisible
t_an.table2

```



#### Question 4 :Quel est le prénom le plus rependu parmis les hommes, les femmes, les filles et les garçons ? 

```{r}

a2 <- african_names %>%
  filter(gender == "Boy") %>% top_n(1) %>% 
    select(name)

b2 <- african_names %>%
  filter(gender == "Girl") %>% top_n(1) %>% 
    select(name)

c2 <- african_names %>%
  filter(gender == "Man") %>% top_n(1) %>% 
    select(name)

d2 <- african_names %>%
  filter(gender == "Woman") %>% top_n(1) %>% 
    select(name)


# Création d'un tableau à la main : 

cat <- c("Top prénom")
Homme <- c("Lellitcho & Satche") ##Ici je réécris les valeurs trouvées avant car il y a deux prénoms et cela est complexe à régler. 
Femme <- c(d2)
Fille <- c(b2)
Garçon <- c(a2)

n.table<-cbind(Homme, Femme, Fille, Garçon)
rownames(n.table)<-cat

t_n.table<-t(n.table) ## J'inverse le sens, car c'est plus lisible

t_n.table 

## Pour les hommes nous avons 2 prénoms, car il y autant d'Hommes qui s'appellent Lettilocho que Satche. 
```



#### Question 5 : Combien de personnes esclaves sont arrivées aux USA durant la période 1808-1862 ?

```{r}
## Je compte le nombre de personnes par années d'arrivées (grâce aux nombre de fois où les années d'arrivées apparaissent, car chaque personne a une date d'arrivée)

yan<-african_names %>% 
  group_by(year_arrival) %>% 
  count(year_arrival) 
  
colnames(yan) [2] <- "nombre_de_pers"

## Ici je trace le plot : 

yangraph<- yan %>% 
  ggplot(aes(x=year_arrival, y = nombre_de_pers))+
  ggtitle("L'évolution du nombre d'esclaves arrivés aux USA de 1808 à 1862")+
   ylab("nombre de personnes") + xlab("années d'arrivées")+
  geom_line()

yangraph + theme_stata() ## Je change le theme pour que ce soit plus lisible

```



#### Question 6 : Quel est le pays où le plus de personnes noires ont été enlevés durant l'époque de la traite négrière ? 

```{r}
## Ici je selectionne le pays d'origine, le port d'embarquement et le port d'arrivé
## Puis je range par ordre alphabétique (par rapport aux pays)
## Je groupe par pays
## Et je compte le nombre d'invidus par rapport aux pays
## Je prends le pays où il y a eu le plus de personnes enlevées

po_intermediaire<-african_names %>% 
  select(country_origin) %>% 
  arrange(country_origin) %>% 
  group_by(country_origin) %>% 
  summarise(nombre_pers_enlevees=n()) %>% 
  top_n(1)
po_intermediaire

## Je me rends compte que ce sont des valeurs manquantes et non un pays, ceci est quand même important pour mon analyse, je garde cette question. 


```

**Il y a beaucoup de données manquantes, cela montre à quel point il est difficile de savoir d'où ces personnes viennent. Aujourd'hui, beaucoup de personnes afro-américaines ayant des parents issus de l'esclavagisme, cherchent leurs origines qui sont très complexes à trouver. Ces données montrent une réalité actuelle : une des conséquences de l'esclavagisme sur les nouvelles générations** 



#### Question 7 : Quels sont les 5 pays connus dans notre base (sans compter les données manquantes), où le plus de personnes on été enlevées durant la traite négrière, et quels sont les ports d'arrivés et d'origines ? 

```{r}

po<-african_names %>% 
  select(country_origin, port_embark, port_disembark) %>% 
  arrange(country_origin) %>% 
  group_by(country_origin) %>% 
  count(country_origin, port_embark, port_disembark) %>% 
  filter(n>450) ## ici j'ai filtre en testant plusieurs fois avec différents nombres, pour avoir 5 pays, il faut prendre n>450

po2<- po[rowSums(is.na(po[, 1])) == 0, ] ## j'enlève les données manquantes

## Je trace deux graphiques : 

po3<-po2 %>% 
  ggplot(aes(x=reorder(country_origin, -n), y = n, fill=port_embark))+ ## j'ordonne par pays et ordre décroissant du nombre de personnes. 
  ggtitle("Nombre de personnes enlevées de leurs pays d'origine")+
   ylab("nombre de personnes") + xlab("pays d'origine")+
           geom_col()+ theme_stata() +
  theme(axis.text.x = element_text( size=7, angle=18),# je change l'angle et la taille del'écriture des pays sur l'axe des x
            axis.text.y = element_text(size=7)) + # la taille de l'écriture des chiffres sur l'axe des y
  theme(axis.title.x = element_text(size = 7,face="bold"))+ # la taille et la mise en gras du titre des x
  theme(axis.title.y = element_text(size = 7,face="bold"))+ theme(title=element_text(size=6.8, face="bold")) +#taille et gras titre axe y et du titre du graph
theme(legend.title = element_text(colour="black", size=6, face="bold")) + #mise en gras, couleur noir, taille titre legende
              theme(legend.text = element_text(colour="black", size=7)) # couleur noir et taille texte légende

po4<-po2 %>% 
  ggplot(aes(x=reorder(country_origin, -n), y = n, fill=port_disembark))+
  ggtitle("Nombre de personnes enlevées de leurs pays d'origine")+
   ylab("nombre de personnes") + xlab("pays d'origine")+geom_col()+ theme_stata() + theme_stata() +
  theme(axis.text.x = element_text( size=7, angle=18), 
            axis.text.y = element_text(size=7)) +
  theme(axis.title.x = element_text(size = 7,face="bold"))+ 
  theme(axis.title.y = element_text(size = 7,face="bold"))+ theme(title=element_text(size=6.8, face="bold")) +
  theme(legend.title = element_text(colour="black", size=6, face="bold")) +
              theme(legend.text = element_text(colour="black", size=7))

plot_grid(po3, po4,labels=c("P1", "P2"), ncol= 2, nrow=1)

```


### 2.2 Analyse du tableau census

#### Question 8: Quelle est la part des personnes noires, esclaves, libres et blanches durant la période 1790-1870 ? 

```{r}

bfb <- census %>% 
  arrange(year) %>% 
  mutate( porcent_black_free_on_black = (black_free/black)*100) %>% ##Ici je mets en % les noirs libres sur la pop noire totale
  select(year, porcent_black_free_on_black) 

bfb2 <- bfb %>% 
  ggplot(aes(x=year, y=porcent_black_free_on_black))+
  labs(title = "Tendance de la part des personnes noires libres sur la pop. noire",
              subtitle = "aux USA durant la période 1790-1870")+
   ylab("pourcentage de personnes noires") + xlab("années")+
  geom_smooth()

bsb <- census %>% 
  arrange(year) %>% 
  mutate(porcent_black_slave_on_black = (black_slaves/black)*100) %>% ##Ici je mets en % les noirs esclaves sur la pop noire totale
  select(year, porcent_black_slave_on_black) 

bsb2 <- bsb %>% 
  ggplot(aes(x=year, y=porcent_black_slave_on_black))+
  labs(title = "Tendance de la part des personnes noires esclaves sur la pop. noire",
              subtitle = "aux USA durant la période 1790-1870")+
   ylab("pourcentage de personnes noires") + xlab("années")+
  geom_smooth()

bt <- census %>% 
  arrange(year) %>% 
  mutate(porcent_black_on_pop = (black/total)*100) %>% ##Ici je mets en % les noirs sur la pop totale
  select(year, porcent_black_on_pop)

bt2 <- bt %>% 
  ggplot(aes(x=year, y=porcent_black_on_pop))+
  labs(title = "Tendance de la part des personnes noires sur la pop. totale",
              subtitle = "aux USA durant la période 1790-1870")+
   ylab("pourcentage de personnes noires") + xlab("années")+
  geom_smooth()

wt <- census %>% 
  arrange(year) %>% 
  mutate(porcent_white_on_pop = (white/total)*100) %>%  ##Ici je mets en % les blancs sur la pop noire totale
  select(year, porcent_white_on_pop) %>% 
  select(year, porcent_white_on_pop)

wt2 <- wt %>% 
  ggplot(aes(x=year, y= porcent_white_on_pop))+
  labs(title = "Tendance de la part des personnes blanches sur la pop. totale",
              subtitle = "aux USA durant la période 1790-1870")+
   ylab("pourcentage de personnes noires") + xlab("années")+
  geom_smooth()

##Ici je change le visuel (voir question avant tout est expliqué)

bfb3<- bfb2 + theme_stata() + 
  theme(axis.title.x = element_text(size = 7, face="bold"))+ 
  theme(axis.title.y = element_text(size =7,face="bold"))+ theme(title=element_text(size=5.7, face="bold"))
bsb3<- bsb2 + theme_stata() + 
  theme(axis.title.x = element_text(size = 7, face="bold"))+ 
  theme(axis.title.y = element_text(size =7,face="bold"))+ theme(title=element_text(size=5.5, face="bold"))
bt3 <- bt2 + theme_stata() + 
  theme(axis.title.x = element_text(size = 7, face="bold"))+ 
  theme(axis.title.y = element_text(size =7,face="bold"))+ theme(title=element_text(size=5.8, face="bold"))
wt3 <- wt2 + theme_stata() + 
  theme(axis.title.x = element_text(size = 7, face="bold"))+ 
  theme(axis.title.y = element_text(size =7,face="bold"))+ theme(title=element_text(size=5.8, face="bold"))

plot_grid(bfb3, bsb3,labels=c("1", "2"), ncol= 2, nrow=1) ## Ici je met sur la meme page deux graphiques
plot_grid(bt3, wt3,labels=c("1", "2"), ncol= 2, nrow=1) ## Ici aussi

```


#### Question 9 : Quelle est la part de personnes noires libres, noires esclaves et blanches selon chaque région ? 

```{r}
## Ici on fait la moyenne par région des colonnes 4 à 8 

a<-aggregate(census[, 4:8], list(census$region), mean) %>% ##je prends les colonnes 4 à 8 et je prends par rapport à la région
  rename(region=Group.1) #je renomme la colonne Group.1 par région, car ca l'a nommé automatiquement avec le code ci dessus. 

## Ici c'est le total de chaque région : 
b <- aggregate(census[, 4:8], list(census$region), FUN = sum) %>% 
  rename(region=Group.1) 

## Ici on va calculer selon les regions la part de personnes noires, blanches, noires et esclave libre, noires et esclave (Les deux dernières colonnes aditionnées font la somme de la deuxième colonne)

c <- b %>% 
  transform (white_total = white / total) %>% 
  transform(black_total = black / total) %>% 
  transform(black_free_total = black_free / total) %>% 
  transform(black_slaves_total = black_slaves / total) %>% 
  select(region, white_total, black_total, black_free_total, black_slaves_total)


## On trace les graphiques en barres : Pour simplifier ici je prends le total (pas les régions)

j <- c %>%
  filter(region == "USA Total")

w_graph <-j %>% 
  ggplot(aes(x=region,y= white_total))+
  geom_col()
 
b_graph<- j %>% 
  ggplot(aes(x=region,y= black_total))+
  geom_col()

bsl_graph<- j %>% 
  ggplot(aes(x=region,y= black_slaves_total))+
  geom_col()

bf_graph <- j %>% 
  ggplot(aes(x=region,y= black_free_total))+
  geom_col()

w_graph2 <- w_graph + ylab("White / Total pop") + xlab("L'ensemble des USA") +
 ggtitle("Part pers. blanches/pop") +
 scale_y_continuous(limits = c(0, 1)) +
  theme(axis.title.x = element_text(size = 7, face="bold"))+ 
  theme(axis.title.y = element_text(size =7,face="bold"))+ theme(title=element_text(size=6, face="bold"))

b_graph2 <-b_graph + ylab("Black / Total pop") + xlab("L'ensemble des USA") +
 ggtitle("Part pers. noires/pop") +
 scale_y_continuous(limits = c(0, 1)) +
  theme(axis.title.x = element_text(size = 7, face="bold"))+ 
  theme(axis.title.y = element_text(size =7,face="bold"))+ theme(title=element_text(size=6, face="bold"))

bsl_graph2 <- bsl_graph + ylab("Black Slaves / Total pop") + xlab("L'ensemble des USA") +
 ggtitle("Part pers. esclaves noires/pop") +
 scale_y_continuous(limits = c(0, 1)) + 
  theme(axis.title.x = element_text(size = 7, face="bold"))+ 
  theme(axis.title.y = element_text(size =7,face="bold"))+ theme(title=element_text(size=5.2, face="bold"))

bf_graph2 <- bf_graph + ylab("Black Free / Total pop") + xlab("L'ensemble des USA") +
 ggtitle("Part pers. libres noires/pop") +
 scale_y_continuous(limits = c(0, 1)) + 
  theme(axis.title.x = element_text(size = 7, face="bold"))+ 
  theme(axis.title.y = element_text(size =7,face="bold"))+ theme(title=element_text(size=5.8, face="bold"))


plot_grid(w_graph2, b_graph2, bsl_graph2, bf_graph2, labels=c("A", "B", "C", "D"), ncol= 4, nrow=1)

##Pour toutes les régions sauf le total :

k <- c %>%
  filter(region %in% c("West","South","Midwest","Northeast"))

w_graph_k <-k %>% 
  ggplot(aes(x=region,y= white_total, fill = white_total))+
  geom_col()
 
b_graph_k <- k %>% 
  ggplot(aes(x=region,y= black_total, fill = black_total))+
  geom_col()

bsl_graph_k <- k %>% 
  ggplot(aes(x=region,y= black_slaves_total, fill=black_slaves_total))+
  geom_col()

bf_graph_k <- k %>% 
  ggplot(aes(x=region,y= black_free_total, fill=black_free_total))+
  geom_col()

w_graph_k2 <- w_graph_k + ylab("White / Total pop") + xlab("L'ensemble des USA") +
 ggtitle("La part des personnes blanches sur le total de la population") +
 scale_y_continuous(limits = c(0, 1)) + theme(title=element_text(size=6, face="bold")) # je mets une échelle de 1

b_graph_k2 <- b_graph_k + ylab("Black / Total pop") + xlab("L'ensemble des USA") +
 ggtitle("La part des personnes noires sur le total de la population") +
 scale_y_continuous(limits = c(0, 1)) + theme(title=element_text(size=6, face="bold")) #Je mets une échelle de 1

bsl_graph_k2 <- bsl_graph_k + ylab("Black Slaves / Total pop") + xlab("L'ensemble des USA") +
 ggtitle("La part des personnes esclaves noires sur le total de la population") +
 scale_y_continuous(limits = c(0, 0.3)) + theme(title=element_text(size=5.8, face="bold")) ##Ici je change l'echelle sinon on ne voit pas grand chose

bf_graph_k2 <- bf_graph_k + ylab("Black Free / Total pop") + xlab("L'ensemble des USA") +
 ggtitle("La part des personnes libres noires sur le total de la population") +
 scale_y_continuous(limits = c(0, 0.3)) + theme(title=element_text(size=6, face="bold")) ## Je change l'échelle ici aussi

plot_grid(w_graph_k2, b_graph_k2, labels=c("E", "F"), ncol= 2, nrow=1) ## je les mets sur le même graph pour pourvoir comparer
plot_grid( bsl_graph_k2, bf_graph_k2, labels=c("G", "H"), ncol= 2, nrow=1)

```

*Note : le dernier graphique n'est pas à la même échelle que les autres, car on ne voyaient pas assez bien les données. De plus la somme des personnes esclaves noires (graphique G) et des personnes libres noires (graphique H) sont le total des personnes noires (F).*


### 2.3 Analyse du tableau slaves routes

#### Question 10 : Quels sont les bateaux transportant plus de 1000 esclaves, et quels sont leurs ports d'arrivés et d'origines ? 

```{r}

sr<-slave_routes[complete.cases(slave_routes), ] ### J'enleve les valeurs manquantes

sr2<- sr %>% 
  filter(n_slaves_arrived>1000) %>% ## je filtre pour avoir des bateaux avec + de 1000 esclaves
  arrange(-n_slaves_arrived) %>% ## Je range par ordre décroissant du nombre de personnes
  select(n_slaves_arrived, ship_name, port_origin, port_arrival) 

## je trace le graphique, avec en coloeur le nom des bateaux et en taille le nomdre de personnes. Je rajoute en descripion sur le graphique le nombre de personnes en chiffres. 

sr3 <- sr2 %>% ggplot(aes(x = port_origin, y = port_arrival, color = ship_name,size = n_slaves_arrived, label=n_slaves_arrived)) + 
    geom_point() + xlab("ports d'origines") + ylab("ports d'arrivés") +
  labs(title = "Ports d'arrivés et d'origines", subtitle = "(par rapport aux nombres d'esclaves et aux noms des bateaux)")+
  geom_text(size = 2.5, color = "black", vjust = -1.5) ##j'ajuste pour pas que ce soit sur le cercle. 

sr4<- sr3 + theme(axis.text.x = element_text( size=6.5, angle=45), 
            axis.text.y = element_text(size=6.5)) +
  theme(axis.title.x = element_text(size = 9, vjust= +25,face="bold"))+ 
  theme(axis.title.y = element_text(size = 9,face="bold"))+ theme(title=element_text(size=9, face="bold"))

sr5 <- sr4 + theme(legend.title = element_text(colour="black", size=9, face="bold")) +
              theme(legend.text = element_text(colour="black", size=7)) ##texte de la légende
sr5


```


### Analyse du tableau blackpast 

#### Question 11 : Quels sont les dates clefs de l'esclavagisme ? 
```{r}

## Il est impossible d'extraire les données. Lorsque je cherche à prendre des dates, elles ne s'affichent pas toutes, je vais donc recréer un tableau à la main, en choisisant des données "importantes" à mon sens dans le tableau blackpast: 


type4 <- c("A", "B", "C", "D", "E", "F")
"Date" <- c(1602, 1619, 1793, 1861, 1865, 1808)
"Evenement" <- c(  "1ère colonie fondée en Virginie", "1ère arrivée documentée d'esclaves en provenance d'Afrique", "Invention de la machine à égrainer le coton, cela va contribuer à l'essor de l'esclavagisme aux USA", "Début de la Guerre de Sécession", "Fin de la Guerre de Sécession et abolition définitive de l’esclavage : Ni esclavage, ni servitude involontaire, n’existeront aux États-Unis, ni dans aucun lieu soumis à leur juridiction","Adoption par le Sénat et la Chambre des représentants des États-Unis de l’interdiction de la traite négrière atlantique. Le Congrès avait déjà décidé cette abolition dès 1794 ! La contrebande d’esclaves se poursuivra cependant encore plusieurs années.")

bp_tab1 <- cbind(Date, Evenement)
rownames(bp_tab1)<-type4
bp_tab2 <- transform(bp_tab1, Date = as.numeric(Date)) ## Je tranforme la colonne date en données numériques
bp_tab2

## Je vais aussi créer un digramme de Gantt :


dat <- data.frame(Position=c(rep(" ", 1)), ##Ici c'est pour écrire à l'intérieur des bandes, et leurs nombres. 
              Name = c( "A","B", "C",  "D", "E", "F"), ## Pour nommer les lignes
              start = rep(c( "1602-01-01", "1619-01-01", "1793-01-01",  "1808-01-01","1861-01-01", "1865-01-01"), 1), 
              end = rep(c( "1602-12-31", "1619-12-31", "1793-12-31","1808-12-31", "1865-12-31", "1865-12-31" ), 1),
              color = c('#00308f', '#5d8aa8', '#72a0c1'), #couleur des bandes
              fontcolor = rep("white", 1)) # couleur du fond
dat2<-vistime(dat, events="Position", groups="Name", title="Dates clefs de l'esclavagisme aux USA") 
dat2

```


Dates clefs : 

A : **1ère colonie fondée en Virginie** - 1602

B : **1ère arrivée documentée d'esclaves en provenance d'Afrique** - 1619

C : **Invention de la machine à égrainer le coton, cela va contribuer à l'essor de l'esclavagisme aux USA** - 1793

D : **Adoption par le Sénat et la Chambre des représentants des États-Unis de l’interdiction de la traite négrière atlantique. Le Congrès avait déjà décidé cette abolition dès 1794 ! La contrebande d’esclaves se poursuivra cependant encore plusieurs années** - 1808

E : **Guerre de Sécession** - 1861-1865

F : **Abolition définitive de l’esclavage : Ni esclavage, ni servitude involontaire, n’existeront aux États-Unis, ni dans aucun lieu soumis à leur juridiction** - 1865


